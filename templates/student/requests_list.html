{% extends 'base.html' %}

{% block title %}Mes RequÃªtes{% endblock %}

{% block content %}
<div class="container">
    <div class="flex flex-between items-center mb-3">
        <h1>ğŸ“‹ Mes RequÃªtes</h1>
        <a href="{% url 'student_create_request' %}" class="btn btn-primary">â• Nouvelle requÃªte</a>
    </div>

    <!-- Filters -->
    <div class="card mb-2">
        <form method="get" class="flex gap-2 items-center">
            <div class="form-group" style="margin: 0; flex: 1;">
                <select name="status" class="form-control form-select" onchange="this.form.submit()">
                    <option value="">Tous les statuts</option>
                    <option value="sent" {% if status_filter == 'sent' %}selected{% endif %}>EnvoyÃ©e</option>
                    <option value="received" {% if status_filter == 'received' %}selected{% endif %}>ReÃ§ue</option>
                    <option value="approved" {% if status_filter == 'approved' %}selected{% endif %}>ApprouvÃ©e</option>
                    <option value="in_cellule" {% if status_filter == 'in_cellule' %}selected{% endif %}>En cellule</option>
                    <option value="returned" {% if status_filter == 'returned' %}selected{% endif %}>RetournÃ©e</option>
                    <option value="done" {% if status_filter == 'done' %}selected{% endif %}>TerminÃ©e</option>
                </select>
            </div>
            <div class="form-group" style="margin: 0; flex: 1;">
                <select name="type" class="form-control form-select" onchange="this.form.submit()">
                    <option value="">Tous les types</option>
                    <option value="cc" {% if type_filter == 'cc' %}selected{% endif %}>CC</option>
                    <option value="exam" {% if type_filter == 'exam' %}selected{% endif %}>EXAM</option>
                </select>
            </div>
            <button type="submit" class="btn btn-outline">Filtrer</button>
            <a href="{% url 'student_requests' %}" class="btn btn-secondary">RÃ©initialiser</a>
        </form>
    </div>

    <!-- Requests Table -->
    <div class="card">
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>MatiÃ¨re</th>
                        <th>Type</th>
                        <th>Statut</th>
                        <th>Date soumission</th>
                        <th>AssignÃ©e Ã </th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for req in requests_list %}
                    <tr class="clickable" onclick="window.location='{% url 'student_request_detail' req.id %}'">
                        <td><strong>{{ req.subject.name }}</strong></td>
                        <td>{{ req.get_type_display }}</td>
                        <td><span class="badge badge-{{ req.status }}">{{ req.get_status_display }}</span></td>
                        <td>{{ req.submitted_at|date:"d/m/Y H:i" }}</td>
                        <td>
                            {% if req.assigned_to %}
                                {{ req.assigned_to.get_full_name }}
                            {% else %}
                                <em>Non assignÃ©e</em>
                            {% endif %}
                        </td>
                        <td onclick="event.stopPropagation();">
                            <a href="{% url 'student_request_detail' req.id %}" class="btn btn-sm btn-primary">Voir dÃ©tails</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center" style="padding: 3rem; color: var(--text-secondary);">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“­</div>
                            <h3>Aucune requÃªte trouvÃ©e</h3>
                            <p>Vous n'avez pas encore soumis de requÃªte.</p>
                            <a href="{% url 'student_create_request' %}" class="btn btn-primary mt-1">CrÃ©er une requÃªte</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% if requests_list %}
        <div class="card-footer">
            <p style="margin: 0; color: var(--text-secondary);">
                Total: <strong>{{ requests_list.count }}</strong> requÃªte(s)
            </p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
