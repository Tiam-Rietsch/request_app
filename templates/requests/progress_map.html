<!-- Progress Map Component -->
<!-- Usage: {% include 'requests/progress_map.html' with request=request_obj %} -->

<div class="card mb-2 no-print">
    <div class="card-header">
        <h3 class="card-title">ğŸ“ Suivi de la requÃªte</h3>
    </div>
    <div class="progress-map">
        <!-- Step 1: EnvoyÃ©e -->
        <div class="progress-step {% if request.status == 'sent' %}active{% elif request.status != 'sent' %}completed{% endif %}">
            <div class="step-icon">
                {% if request.status == 'sent' %}
                    <span style="font-size: 1.5rem;">ğŸ“¤</span>
                {% else %}
                    <span style="font-size: 1.5rem;">âœ“</span>
                {% endif %}
            </div>
            <div class="step-content">
                <div class="step-title">EnvoyÃ©e</div>
                <div class="step-desc">RequÃªte soumise</div>
                {% if request.submitted_at %}
                    <div class="step-time">{{ request.submitted_at|date:"d/m/Y H:i" }}</div>
                {% endif %}
            </div>
        </div>

        <!-- Step 2: ReÃ§ue -->
        <div class="progress-step {% if request.status == 'received' %}active{% elif request.status in 'approved,rejected,in_cellule,returned,done' %}completed{% endif %}">
            <div class="step-icon">
                {% if request.status == 'received' %}
                    <span style="font-size: 1.5rem;">ğŸ‘€</span>
                {% elif request.status in 'approved,rejected,in_cellule,returned,done' %}
                    <span style="font-size: 1.5rem;">âœ“</span>
                {% else %}
                    <span style="font-size: 1.5rem; opacity: 0.3;">ğŸ“¥</span>
                {% endif %}
            </div>
            <div class="step-content">
                <div class="step-title">ReÃ§ue</div>
                <div class="step-desc">Prise en charge</div>
                {% if request.assigned_to %}
                    <div class="step-time">Par {{ request.assigned_to.get_full_name }}</div>
                {% endif %}
            </div>
        </div>

        <!-- Step 3: DÃ©cision (ApprouvÃ©e/RejetÃ©e) -->
        <div class="progress-step {% if request.status in 'approved,rejected' %}active{% elif request.status in 'in_cellule,returned,done' %}completed{% endif %}">
            <div class="step-icon">
                {% if request.status == 'approved' %}
                    <span style="font-size: 1.5rem;">âœ…</span>
                {% elif request.status == 'rejected' %}
                    <span style="font-size: 1.5rem;">âŒ</span>
                {% elif request.status in 'in_cellule,returned,done' %}
                    <span style="font-size: 1.5rem;">âœ“</span>
                {% else %}
                    <span style="font-size: 1.5rem; opacity: 0.3;">âš–ï¸</span>
                {% endif %}
            </div>
            <div class="step-content">
                <div class="step-title">
                    {% if request.status == 'approved' %}
                        ApprouvÃ©e
                    {% elif request.status == 'rejected' %}
                        RejetÃ©e
                    {% else %}
                        DÃ©cision
                    {% endif %}
                </div>
                <div class="step-desc">
                    {% if request.status == 'approved' %}
                        Demande acceptÃ©e
                    {% elif request.status == 'rejected' %}
                        Demande refusÃ©e
                    {% else %}
                        En attente de dÃ©cision
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Step 4: En Cellule (only if approved) -->
        {% if request.status in 'approved,in_cellule,returned,done' %}
        <div class="progress-step {% if request.status == 'in_cellule' %}active{% elif request.status in 'returned,done' %}completed{% endif %}">
            <div class="step-icon">
                {% if request.status == 'in_cellule' %}
                    <span style="font-size: 1.5rem;">ğŸ’»</span>
                {% elif request.status in 'returned,done' %}
                    <span style="font-size: 1.5rem;">âœ“</span>
                {% else %}
                    <span style="font-size: 1.5rem; opacity: 0.3;">ğŸ’»</span>
                {% endif %}
            </div>
            <div class="step-content">
                <div class="step-title">En Cellule</div>
                <div class="step-desc">Traitement informatique</div>
            </div>
        </div>

        <!-- Step 5: RetournÃ©e -->
        <div class="progress-step {% if request.status == 'returned' %}active{% elif request.status == 'done' %}completed{% endif %}">
            <div class="step-icon">
                {% if request.status == 'returned' %}
                    <span style="font-size: 1.5rem;">â†©ï¸</span>
                {% elif request.status == 'done' %}
                    <span style="font-size: 1.5rem;">âœ“</span>
                {% else %}
                    <span style="font-size: 1.5rem; opacity: 0.3;">â†©ï¸</span>
                {% endif %}
            </div>
            <div class="step-content">
                <div class="step-title">RetournÃ©e</div>
                <div class="step-desc">Retour au responsable</div>
            </div>
        </div>
        {% endif %}

        <!-- Step 6: TerminÃ©e -->
        <div class="progress-step {% if request.status == 'done' %}active completed{% endif %}">
            <div class="step-icon">
                {% if request.status == 'done' %}
                    <span style="font-size: 1.5rem;">ğŸ‰</span>
                {% else %}
                    <span style="font-size: 1.5rem; opacity: 0.3;">ğŸ</span>
                {% endif %}
            </div>
            <div class="step-content">
                <div class="step-title">TerminÃ©e</div>
                <div class="step-desc">Traitement complet</div>
            </div>
        </div>
    </div>
</div>
