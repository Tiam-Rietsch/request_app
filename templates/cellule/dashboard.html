{% extends 'base.html' %}

{% block title %}Dashboard Cellule{% endblock %}

{% block content %}
<div class="container">
    <div class="flex flex-between items-center mb-3">
        <div>
            <h1>üíª Dashboard Cellule Informatique</h1>
            <p style="margin: 0.5rem 0 0 0; color: var(--text-secondary);">
                Bienvenue, <strong>{{ request.user.get_full_name }}</strong>
            </p>
        </div>
        <a href="/cellule/requests/" class="btn btn-primary">Voir toutes les requ√™tes</a>
    </div>

    <!-- Stats Cards -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
        <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <h3 style="margin: 0 0 0.5rem 0; font-size: 2.5rem; font-weight: 700;">{{ total_requests }}</h3>
            <p style="margin: 0; opacity: 0.9; font-size: 1rem;">En cours</p>
        </div>
        <div class="card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
            <h3 style="margin: 0 0 0.5rem 0; font-size: 2.5rem; font-weight: 700;">{{ in_cellule_count }}</h3>
            <p style="margin: 0; opacity: 0.9; font-size: 1rem;">En cellule</p>
        </div>
        <div class="card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
            <h3 style="margin: 0 0 0.5rem 0; font-size: 2.5rem; font-weight: 700;">{{ returned_count }}</h3>
            <p style="margin: 0; opacity: 0.9; font-size: 1rem;">Retourn√©es</p>
        </div>
    </div>

    <!-- Recent Requests -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">üìã Requ√™tes r√©centes √† traiter</h3>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>√âtudiant</th>
                        <th>Mati√®re</th>
                        <th>Type</th>
                        <th>Assign√©e √†</th>
                        <th>Date envoi</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for req in recent_requests %}
                    <tr class="clickable" onclick="window.location='/cellule/requests/{{ req.id }}/'">
                        <td>
                            <strong>{{ req.student_name }}</strong>
                            <br>
                            <small style="color: var(--text-secondary);">{{ req.matricule }}</small>
                        </td>
                        <td>{{ req.subject.name }}</td>
                        <td>{{ req.get_type_display }}</td>
                        <td>{{ req.assigned_to.get_full_name }}</td>
                        <td>{{ req.submitted_at|date:"d/m/Y H:i" }}</td>
                        <td onclick="event.stopPropagation();">
                            <a href="/cellule/requests/{{ req.id }}/" class="btn btn-sm btn-primary">Voir</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center" style="padding: 3rem; color: var(--text-secondary);">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üì≠</div>
                            <h3>Aucune requ√™te en attente</h3>
                            <p>Il n'y a actuellement aucune requ√™te √† traiter.</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Info Card -->
    <div class="card mt-2">
        <div class="card-header">
            <h4 style="margin: 0;">‚ÑπÔ∏è Informations</h4>
        </div>
        <div style="padding: 1rem;">
            <div style="margin-bottom: 1rem;">
                <strong style="color: var(--text-secondary); font-size: 0.875rem;">Total trait√© (historique)</strong>
                <p style="margin: 0.25rem 0 0 0; font-size: 1.25rem; color: var(--primary);">{{ all_time_count }} requ√™tes</p>
            </div>
            <div class="alert alert-info" style="margin-top: 1rem;">
                <strong>Votre r√¥le:</strong> Traiter les requ√™tes approuv√©es et les retourner aux responsables apr√®s modification des notes dans le syst√®me.
            </div>
        </div>
    </div>
</div>
{% endblock %}
